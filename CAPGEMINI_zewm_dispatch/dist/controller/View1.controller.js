sap.ui.define(["sap/ui/core/mvc/Controller","com/safran/ewm/zewm_dispatch/controller/BaseController","sap/m/MessageBox","sap/ui/model/json/JSONModel","sap/m/MessagePopover","sap/m/MessageItem"],function(e,t,o,s,a,n){"use strict";var i;var r;var d;var g;return e.extend("com.safran.ewm.zewm_dispatch.controller.View1",{onInit:function(){d=this.getOwnerComponent().getModel("oGlobalModel");g=this.getOwnerComponent().getModel("oErrorFlagModel");var e=new n({type:"{oMsgModel>type}",title:"{oMsgModel>title}",description:"{oMsgModel>description}"});i=new a({items:{path:"oMsgModel>/",template:e}});r=new s;this.getView().setModel(r,"oMsgModel");this.byId("idView1MsgBox").addDependent(i);this.getView().addStyleClass(this.getOwnerComponent().getContentDensityClass());sap.ui.core.UIComponent.getRouterFor(this).getRoute("View1").attachMatched(this._onRoute,this);this.getPendingHU();this.getView().byId("idHUSource").setValueState("None")},_onRoute:function(e){g.setData({Flag:"false"});this.getView().byId("idBottomText").setText(d.getData().Message);this.getView().byId("idHUSource").setValueState("None");this.getView().byId("idHUSource").setValue()},getPendingHU:function(e){var t=this;var o="/sap/opu/odata/sap/ZLEWM_DISPATCH_APP_SRV/";var s=new sap.ui.model.odata.ODataModel(o);s.setHeaders({"Content-Type":"application/json"});var a=function(e,o){t.getView().byId("txtHUPending").setText(e.results[0].PendingHU);t.getView().byId("txtWhno").setText(e.results[0].Whno)};var n=function(e){};var i="DispatchPendingHUSet";s.read(i,{success:a,error:n})},onPage2:function(e){this.getOwnerComponent().getModel("oGlobalModel").setData();var t=e;var o=JSON.stringify(t);var s=o.replace(/\//g,"@");var a=sap.ui.core.UIComponent.getRouterFor(this);a.navTo("View2",{entity:JSON.stringify(s)})},getResourceBundle:function(){return this.getOwnerComponent().getModel("i18n").getResourceBundle()},getText:function(e,t){return this.getResourceBundle().getText(e,t)},onSearch:function(){var e=this.getView().byId("idHUSource").getValue();var t=this;if(e==""){this.getView().byId("idHUSource").setValueState("Error");o.warning(this.getText("enterHUError"))}else{var s="/sap/opu/odata/sap/ZLEWM_DISPATCH_APP_SRV/";var a=new sap.ui.model.odata.ODataModel(s);a.setHeaders({"Content-Type":"application/json"});var n=function(e,o){g.setData({Flag:"true"});t.onPage2(e);t.byId("idView1MsgBox").setType("Emphasized")};var i=function(e){g.setData({Flag:"false"});t.getView().setBusy(false);var o=$($.parseHTML(e.response.body)).find("message").length;var s=[];if(o==0){var a={type:"Error",title:e.message,description:""};s.push(a);t.byId("idView1MsgBox").setType("Reject")}else{for(var n=0;n<o;n++){var a={type:"Error",title:$($.parseHTML(e.response.body)).find("message")[n].innerText,description:""};s.push(a);t.byId("idView1MsgBox").setType("Reject")}}var i=[...new Map(s.map(e=>[e.title,e])).values()];r.setData(i)};var d="DispatchDetailSet(HandlingUnit='"+e+"',LogFlag='Y')";a.read(d,{success:n,error:i})}},handleMessagePopoverPress:function(e){i.toggle(e.getSource())}})});