sap.ui.define(["sap/ui/core/mvc/Controller","com/safran/ewm/zewm_dispatch/model/formatter","sap/m/MessageBox","sap/ui/Device","sap/ui/model/json/JSONModel","sap/m/MessagePopover","sap/m/MessageItem"],function(e,t,a,s,o,i,n){"use strict";var r;var l;var d;var c;return e.extend("com.safran.ewm.zewm_dispatch.controller.View2",{formatter:t,onInit:function(){d=this.getOwnerComponent().getModel("oGlobalModel");c=this.getOwnerComponent().getModel("oErrorFlagModel");var e=new n({type:"{oMsgModel>type}",title:"{oMsgModel>title}",description:"{oMsgModel>description}"});r=new i({items:{path:"oMsgModel>/",template:e}});this.oComp=sap.ui.component(sap.ui.core.Component.getOwnerIdFor(this.getView()));this.oDataModel=this.oComp.getModel();var t=new sap.ui.model.json.JSONModel;this.getView().setModel(t,"oDataModel");var a=new sap.ui.model.json.JSONModel;this.getView().setModel(a,"oStockModel");var s=new sap.ui.model.json.JSONModel;this.getView().setModel(s,"oWarehouseModel");var o=new sap.ui.model.json.JSONModel;this.getView().setModel(o,"oMRPModel");var l=sap.ui.core.UIComponent.getRouterFor(this);l.getRoute("View2").attachPatternMatched(this._onRouteMatched,this)},getContentDensityClass:function(){if(this._sContentDensityClass===undefined){if(jQuery(document.body).hasClass("sapUiSizeCozy")||jQuery(document.body).hasClass("sapUiSizeCompact")){this._sContentDensityClass=""}else if(!s.support.touch){this._sContentDensityClass="sapUiSizeCompact"}else{this._sContentDensityClass="sapUiSizeCozy"}}return this._sContentDensityClass},_onRouteMatched:function(e){var t=c.getData();this.byId("MsgBoxId").setType("Emphasized");l=new o;this.getView().setModel(l,"oMsgModel");this.byId("MsgBoxId").addDependent(r);var a=e.getParameter("arguments").entity;var s=a.replace(/@/g,"/");var i=JSON.parse(s);this.SelectedData=JSON.parse(i);if(t.Flag=="false"){this.getView().byId("idNotFoundPage").setVisible(true);this.getView().byId("idPage2").setVisible(false)}else if(t.Flag=="true"){this.getView().byId("idNotFoundPage").setVisible(false);this.getView().byId("idPage2").setVisible(true);this.SelectedData.Quantity=parseInt(this.SelectedData.Quantity);this.SelectedData.MaximumQuantity=parseInt(this.SelectedData.MaximumQuantity);this.SelectedData.TotalPhysicalStock=parseInt(this.SelectedData.TotalPhysicalStock);this.SelectedData.TotalMrpStock=parseInt(this.SelectedData.TotalMrpStock);this.SelectedData.TotalWhTaskStock=parseInt(this.SelectedData.TotalWhTaskStock);if(this.SelectedData.Sled!==null){this.SelectedData.Sled=new Date(this.SelectedData.Sled.toString().split("T")[0])}this.getView().getModel("oDataModel").setData(this.SelectedData);this.oHU=this.SelectedData.HandlingUnit;if(this.SelectedData.DispatchCase==="CASE2"){this.getView().byId("idCase1Form").setVisible(false);this.getView().byId("idCase2Form").setVisible(true)}else{this.getView().byId("idCase1Form").setVisible(true);this.getView().byId("idCase2Form").setVisible(false)}}},onBeforeRendering:function(){},getNavData:function(e){var t=this;var a="/sap/opu/odata/sap/ZLEWM_DISPATCH_APP_SRV/";var s=new sap.ui.model.odata.ODataModel(a);s.setHeaders({"Content-Type":"application/json"});var o=function(e,a){t.getView().getModel("oStockModel").setData(e.NAV_STOCK_CARD.results);t.getView().getModel("oMRPModel").setData(e.NAV_MRP_CARD.results);t.getView().getModel("oWarehouseModel").setData(e.NAV_WHNO_TASK_CARD.results);if(e.NAV_WHNO_TASK_CARD.results.length>0){t.WarehouseTask=e.NAV_WHNO_TASK_CARD.results[0].WarehouseTask}};var i=function(e){};var n="DispatchDetailSet(HandlingUnit='"+e+"',LogFlag='N')?$expand=NAV_STOCK_CARD,NAV_MRP_CARD,NAV_WHNO_TASK_CARD";s.read(n,{success:o,error:i})},onPressDetailedLog:function(){var e=sap.ushell&&sap.ushell.Container&&sap.ushell.Container.getService&&sap.ushell.Container.getService("CrossApplicationNavigation");var t=e&&e.hrefForExternal({target:{semanticObject:"ApplicationLog",action:"showList"},params:{LogObjectId:"ZLOBJ_DISPATCH",LogObjectSubId:"ZLSUBOBJ_DISPATCH",LogExternalId:this.oHU}});var a=window.location.href.split("#")[0]+t;sap.m.URLHelper.redirect(a,true)},onPressPacking:function(){var e=sap.ushell&&sap.ushell.Container&&sap.ushell.Container.getService&&sap.ushell.Container.getService("CrossApplicationNavigation");var t=e&&e.hrefForExternal({target:{semanticObject:"EWMWorkCenter",action:"packInternal"},params:{}});var a=window.location.href.split("#")[0]+t;sap.m.URLHelper.redirect(a,true)},getDialog:function(e,t){var a=this.getView();var s=a.byId(e);if(!s){s=sap.ui.xmlfragment(a.getId(),"com.safran.ewm.zewm_dispatch.view.fragments."+t,this);a.addDependent(s)}s.addStyleClass(this.getOwnerComponent().getContentDensityClass());return s},onPressStockTile:function(){var e=this;sap.ui.core.BusyIndicator.show();var t="/sap/opu/odata/sap/ZLEWM_DISPATCH_APP_SRV/";var s=new sap.ui.model.odata.ODataModel(t);s.setHeaders({"Content-Type":"application/json"});var o=function(t,a){sap.ui.core.BusyIndicator.hide();e.getView().getModel("oStockModel").setData(t.NAV_STOCK_CARD.results);e._StockDialog=sap.ui.xmlfragment("com.safran.ewm.zewm_dispatch.view.fragments.Stock",e);e.getView().addDependent(e._StockDialog);e._StockDialog.open()};var i=function(t){sap.ui.core.BusyIndicator.hide();a.error(e.getView().getModel("i18n").getResourceBundle().getText("error"))};var n="DispatchDetailSet(HandlingUnit='"+this.oHU+"',LogFlag='N')?$expand=NAV_STOCK_CARD";s.read(n,{success:o,error:i})},onStockClose:function(){this._StockDialog.close();this._StockDialog.destroy()},onPressWarehouseTile:function(){var e=this;sap.ui.core.BusyIndicator.show();var t="/sap/opu/odata/sap/ZLEWM_DISPATCH_APP_SRV/";var s=new sap.ui.model.odata.ODataModel(t);s.setHeaders({"Content-Type":"application/json"});var o=function(t,a){sap.ui.core.BusyIndicator.hide();e.getView().getModel("oWarehouseModel").setData(t.NAV_WHNO_TASK_CARD.results);e._WarehouseDialog=sap.ui.xmlfragment("com.safran.ewm.zewm_dispatch.view.fragments.WarehouseTasks",e);e.getView().addDependent(e._WarehouseDialog);e._WarehouseDialog.open()};var i=function(t){sap.ui.core.BusyIndicator.hide();a.error(e.getView().getModel("i18n").getResourceBundle().getText("error"))};var n="DispatchDetailSet(HandlingUnit='"+this.oHU+"',LogFlag='N')?$expand=NAV_WHNO_TASK_CARD";s.read(n,{success:o,error:i})},onWarehouseClose:function(){this._WarehouseDialog.close();this._WarehouseDialog.destroy()},onPressMRPTile:function(){var e=this;sap.ui.core.BusyIndicator.show();var t="/sap/opu/odata/sap/ZLEWM_DISPATCH_APP_SRV/";var s=new sap.ui.model.odata.ODataModel(t);s.setHeaders({"Content-Type":"application/json"});var o=function(t,a){sap.ui.core.BusyIndicator.hide();e.getView().getModel("oMRPModel").setData(t.NAV_MRP_CARD.results);e._MRPDialog=sap.ui.xmlfragment("com.safran.ewm.zewm_dispatch.view.fragments.MRP",e);e.getView().addDependent(e._MRPDialog);e._MRPDialog.open()};var i=function(t){sap.ui.core.BusyIndicator.hide();a.error(e.getView().getModel("i18n").getResourceBundle().getText("error"))};var n="DispatchDetailSet(HandlingUnit='"+this.oHU+"',LogFlag='N')?$expand=NAV_MRP_CARD";s.read(n,{success:o,error:i})},onMRPClose:function(){this._MRPDialog.close();this._MRPDialog.destroy()},onClickValidationCase1:function(){var e="";this.onCreate(e)},onClickValidationCase2:function(){var e=this;this.getView().byId("idDestinationHUCase2").setValueState("None");var t=this.getView().byId("idDestinationHUCase2").getValue();var s=this.getOwnerComponent().getModel();if(t==""){this.getView().byId("idDestinationHUCase2").setValueState("Error");a.warning("{i18n>destinationInputError}")}else{s.callFunction("/FI_PackSourceHUToDestinationHU",{method:"POST",urlParameters:{SourceHU:this.oHU,DestinationHU:t,SourceStorageType:this.SelectedData.StorageType,SourceStorageBin:this.SelectedData.StorageBin,DestinationStorageType:this.SelectedData.DestinationStorageType,DestinationStorageBin:this.SelectedData.DestinationStorageBin},success:function(t,a){c.setData({Flag:"false"});e.getOwnerComponent().getModel("oGlobalModel").setData(t);var s=sap.ui.core.UIComponent.getRouterFor(e);s.navTo("View1")},error:function(t){var a=[];if(t.hasOwnProperty(t)){var s=$($.parseHTML(t.response.body)).find("message").length;for(var o=0;o<s;o++){var i={type:"Error",title:$($.parseHTML(t.response.body)).find("message")[o].innerText,description:""};a.push(i);e.byId("MsgBoxId").setType("Reject")}var n=[...new Map(a.map(e=>[e.title,e])).values()];l.setData(n)}else{var i={type:"Error",title:JSON.parse(t.responseText).error.message.value,description:""};a.push(i);e.byId("MsgBoxId").setType("Reject");var n=[...new Map(a.map(e=>[e.title,e])).values()];l.setData(n)}}})}},onChangeFragment:function(){this.getView().byId("idCase1Form").setVisible(false);this.getView().byId("idCase2Form").setVisible(true)},onCreate:function(e){var t=this;var a=this.getOwnerComponent().getModel();a.callFunction("/FI_CreateWarehouseTask",{method:"POST",urlParameters:{HandlingUnit:this.oHU,Simulation:e},success:function(e,a){c.setData({Flag:"false"});t.getOwnerComponent().getModel("oGlobalModel").setData(e);var s=sap.ui.core.UIComponent.getRouterFor(t);s.navTo("View1")},error:function(e){t.getView().setBusy(false);var a=$($.parseHTML(e.response.body)).find("message").length;var s=[];for(var o=0;o<a;o++){var i={type:"Error",title:$($.parseHTML(e.response.body)).find("message")[o].innerText,description:""};s.push(i);t.byId("MsgBoxId").setType("Reject")}const n=[...new Map(s.map(e=>[e.title,e])).values()];l.setData(n)}})},handleMessagePopoverPress:function(e){r.toggle(e.getSource())},onBackPressed:function(){var e=sap.ui.core.UIComponent.getRouterFor(this);e.navTo("View1")}})});